Заголовок локальные параметры подпрограмм

Если параметров немного, то их можно хранить в регистрах,
если много, то возможны различные варианты, однако,
если мы будем хранить их в сегменте данных, то большую часть времени
они не будут использоваться, то есть, лучше хранить локальные параметры
в стеке.

Например, если параметров локальных немного,
то стек может выглядеть так (слайд)

Сразу после входных действий нужно выделить память под локальные параметры
изменив значение регистра SP, тогда шаблон подпрограммы, в которой
и локальные и фактические параметры передаются через стек и локальные
содержатся в стеке, можно представить следующим образом (слайд 22)

Также нужно сохранить в стеке все регистры, которые будем использовать
в подпрограмме.

Посчитаем количество различных симолов в заданной строке.
Строка - массив символов, адрес начала которой передадим через
регистр BX, длину строки - CX, а результат будем хранить в 
регистре AX. Для этого создадим локальный массив l размером
в 256 байтов и k-тому элементу этого массива будем присваивать 1,
если символ, цифровой код которого равен k, содержится в 
этой строке. Вначале массив обнулим, а в конце
посчитаем количество единичек. К первому элементу массива 
можно обратиться по формуле l1 = [BP - 265], а к lk = [BP - 256 +k]

программа (слайд + слайд + слайд)

Заголовк рекурсия в ассемблере

Зацикливание не произойдёт, если в программе есть 2 ветви:
рекурсиная и нерекурсивная и, при выполнении некоторого условия,
вычислительный процесс идёт не по рекурсивной ветви.

Если параметры будут храниться в сегменте данных, то рекурсии не 
получится. Если есть такая необходимость, то пр входе в программу
их нужно записать в стек, а потом использовать, то есть
в рекурсии параметры нужно передавать через стек.

Примеры: (слайд)

Заголовок работа со строками

Строка это последовательность байтов, слов, или двойных слов. 
Строка источник находится по адресу DS:SI или EDS:ESI, а строка 
приёмник по адресу ES:DI, или ES:EDI.

Каждая команда работает только с 1 элементом строки (байтом,
словом или двойным словом. Это зависит от типа команды
или от типа Операнда), чтобы выполнить действие над всей строкой
нужно использовать специальные префиксы, которые действуют только 
на строковые команды.

Префиксы: 

1) rep - повторять

2) repe - повторять пока равно

3) repz - повторять пока ноль

4) repne - повторять пока не равно

4) repnz - повторять пока не ноль

Префикс rep заставляет повторять выполнение строкой команды n раз,
n должно содержаться в регистре CX, а если CX будет = 0, то 
команда не выполнится ни разу.

repe и repz выполняет указанную команду пока ZF = 1, но не более
n раз. представить работу команды можно в виде (слайд)

repne repnz указанная строковая команда будет выполняться до тех
пор пока ZF = 0, но не более n раз.
Псевдокод (слайд)

rep работает с командами: movs, lods, stos, ins, outs

repe, repz, repne, repnz с командами: cmps, scas

Команды для копирования строк (слайд)

Если используется вариант movs, то ассемблер по типу операндов
сам определяет сколько байтов нужно переслать (1, 2 или 4).
В этой команде DS можно изменить на регистры ES,GS,FS,CS,SS,
но ES изменять нельзя.

Для всех строковых команд, после выполнение команды, содержимое
регитсров SI DI автоматически изменяется в зависимости от 
флага DF. Содержимое индексных регистров увеличивается на 1 или 2,
или 4 (зависит от вида команды), если DF = 0, иначе содержимое
регистров уменьшается на то же значение.

команды сравнение строк (слайд)

1-ый вариант команды в зависимости от типа операндов ассемблер сравнивает
содержимое байтов, слов или двойных слов (зависит от типа операндов).

Эти команды используются с префиксами repe, repz, repne, repnz

scas op1

виды команд (слайд)

При работе 1-ого варианта команды количество сравниваемых байтов
зависит от разрядности операндов.

Команды cmps и scas устанавливают флаги аналогично команде cmp.

Команды считывания строки из памяти и загрузки в аккумулятор.

lods op2

варианты (слайд)

Команды записи из регистра AL, AX или EAX в память в строку,
расположенную по адресу ES:DI  или ES:EDI.

lods op2 работает как lodsb, lodsw, lodsw, в зависимости
от типа операнда и здесь DS можно заменить на ES, FS, GS SS.

stos op1

варианты (слайд)

При использовании этих команд с префиксом rep строка длиной в (слайд)

команды считавания из порта ввода/вывода

ins op1, DX

Любой из этих команд можно считать из порта ввода вывода номер который
содержится в регистре DX (байт, слово, двойное слова) и записать в
память ES:DI или ES:EDI. Работа 1 зависит от типа операнда.

При использовании с повторителем rep можно прочитать блок данных
и переслать их в некоторую область памяти.

Запись в порт содержимое ячейки памяти, размером в байт, слово или 
двойное слово, находящейся по адресу DS:SI или DS:ESI

outs DX,op2

(слайд)

с повторителем может вывести много данных

Номер пора должен быть всегда в DX

Команды управления флагами.

В зависимости от флага DF мы можем просматривать сроку в сторону
увеличения адресов или уменьшения адресов, но этот флаг должен
устанавливать сам программист с помощью команд (слайд):

Кроме флага DF программист может изменить следуюзие флаги: (слайд +
слайд)

Загрузка сегментных регистров (слайд)

Для всех команд op2 - переменная в ОП размеров в 32 или 48 бит в
зависимости от разряда операндов. Первые 16 бит этой переменной 
загружаются в соответствующий сегмент DS, ES и т.д.,
а следующие 16 или 32 - в регистр общего назначения, указанный в 
качестве первого операнда.

Загрузка сегментных регистров пример (слайд)

пример использования команд работы со строками (слайд)

пример 2 нужно в строке S состоящей из 500 символов
заменить первое вхождение "*" на ".". (слайд)