Описание макроса, выглядит следующим образом:

(слайд 64)

Формальные параметры - это локальные имена никак не связанные с объектами
языка, записываются через запятую и/или пробел, их может быть
произвольное количество, но они должны умещаться в 1 строке. 

Тело макроса - это любые команды и директивы языка, которые создают правильные
конструкции языка после подстановки формальных параметров.

Директива LOCAL, если мы обращаемся к макросу несколько раз, то может
оказаться, что у нас повторяются одни и те же методы в исходном тексте,
поскольку на месте макрокоманды появляется макрорасширение и тогда
будет сообщение об ошибке, чтобы этого не случилось в макросы добавляют
директиву LOCAL.

Макрокоманда/ обращение к макросу записывается следующим
образом:

(слайд 64)

Фактические параметры записываются через запятую и/или пробел, фактическим
параметром может быть любой текст, в том числе и пустой, но обязательно
сбалансированным по угловым скобкам и кавычкам. В фактическом 
параметре не может быть разделителей вне кавычек и вне угловых
скобок, иначе запятая воспринимается как разделитель, а ;, как начало 
комментария. В теле макроса может использоваться директива 
EXITM, которая позволяет осуществить досрочный выход из макроса, в
том случае, если в теле макроса используются директивы условной
генерации. 

С помощью директивы

PURGE <имя макроса>,

можно отменить определённый ранее макросы, если их было много, они были
объединены вместе и содержались в файле на диске и подключены с помощью
директивы include.

заголовок примеры макросов

Использование макросов позволяет писать программу в терминах более
крупных операций. Опишем в виде макроса:

(слайд 66)

Используя этот макрос, для вычисления минимального из 3-х:

(слайд 66)

После макрогенерации в программе будет вот такой текст:

(слайд 67)

Говорят, что обращение к процедуре будет нагляднее, если параметры
передавать с помощью макроса.

Например: (слайд 67 + 68)

Исспользование меток в макросе:

Если есть макрос, то может оказаться дублирование меток.

Например: (слайд 68)

Если в теле макроса есть метки и есть директива LOCAL, то во время 
макрогенерации метки из списка директивы LOCAL замещаются на специальные
метки вида 

?? и 16-тиричная константа в диапазоне от 0 до FFFF 

Пример; ??FFFF

Пример 2: Вычислить остаток от деления одного числа на другое
с помощью вычитания.

(слайд 69)

Вложенные макросы

Макрос вывода строки на экран может выглядеть так:

(слайд 70)

(слайд 71) (или фото)

Макрос и блок внутри макроса:

(фото)

Обращение к такому макросу имеет вид:

(фото)

Здесь угловые скобки обязательны. То есть макрос принимает 1 параметр, список
параметров, которые передаются блоку (блок принимает много параметров).

Заголовок директивы условной генерации

Диреткивы условной генерации позволяют изменять исходный текст программы
в процессе макрогенерации. В зависимости от некоторого условия
фрагмент программы можнт подключаться, или не подключаться (не добавляться)

Общий вид директивы условной генерации следующий:

(слайд 72)

Если выражение имеет значение истина, то их часть добавляется в текст
программы иначе в текст программы добавляется else часть, если она есть.

второй вариант:

(слайд 72)

Рассмотрим директивы условной генерации:

1) if<константное выражение> if-часть

if-часть ассемблируется, включается в исходный текст программы, если 
выражение имеет значение истина, то есть не равное нулю, в противном
случае в текст программы включается else часть, если она есть, иначе,
выполняется следующий за директивой if оператов.

2) (слайд 73)

if-часть работает, если выражение ложно, равно нулю.

3) (слайд 74)

if-часть работает, если указанная метка определена

4) (слайд 74)

if-часть работает, если указанная метка не определена

5) (слайд 74)

if-часть работает, если значением аргумента является не пробел

6) (слайд 74)

if-часть работает, если значением аргумента является не пробел

7) (слайд 74)

if-часть работает, если аргументы различны, прописные и строчные буквы
различаются

8) (слайд 75)

if-часть работает, если аргументы различны, прописные и строчные
буквы не различаются

9) (слайд 75)

if-часть работает, если аргументы одинаковы, прописные и строчные буквы
различаются

10) (слайд 75)

if-часть работает, если аргументы одинаковы, прописные и строчные буквы не 
различаются 

Здесь угловые скобки обязательны

Например, директивы условной генерации можно использовать непосредственно
в программе (не в блоках и не макросах). Когда, отлаживаем программу, то в
текст программы мы вставляем промежуточные (отладочные) печати, а если прогрмамму
уже отладили, то эти печати выбрасываем. А если мы поручим это процессу
ассемблирования, то таких ошибок не булет. Можно определить контанту, например,
0 и 1, одна говорит, что это режим отладки, а другая - счёта, и тогда в 
режиме отладки, в процессе макрогенерации в текст будут вставляться
отладочные печати, а в процессе счёта с другим значением параметра, они
вставляться не будут.

Например: (слайд 76)

После макрогенерации в программе появится текст

(слайд 77)

Можно было не использовать директиву условной генерации, можно в тексте программы
вставлять кусок текста

(слайд 77)

Однако этот текст всегда будет храниться в памяти и это не экономично.

заголовко примеры использования директив условной генерации в макросах

пример: 

Опишем в виде макроса операцию сдвига значения переменной x на n разрядов
вправо. n-явно заданное положительное число. Макрорасширение должно содержать
минимально возможно число команд. Это можно сделать так:

(слайд 78)

Пример 2:

Константное выражение в if и ife может быть любым, однако оно вычисляется
на этапе макрогенерации и это значит, что в этом выражении не должно быть
никаких велечин, которые определяются в процессе выполнения программы (там 
не должно быть регистров и адресов памяти и оно должно вычисляться при первом
проходе макрогенератора), но при этом константа может быть логической, в ней
могут содержаться операторы отношения (EQ, NE, LT, LE, GT, GE ...)
и логические операторы (NOT, OR, XOR).

Пример: 

(слайд 82)

Пример 3:

Сдвиг вправо на n разрядов байтовой переменной B. Учитывая, что
при n = 0 сдвига нет и макрорасширение в текст не должно появиться, а 
при n > 7 результатом сдвига будет 0, поэтому заменяем сдвиг 
записью 0 в текст, и тогда вариант макроса может быть таким:

(слайд 80)